(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{2320:function(r,e,t){Promise.resolve().then(t.bind(t,3549)),Promise.resolve().then(t.t.bind(t,2148,23))},3549:function(r,e,t){"use strict";t.r(e),t.d(e,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var n=t(7437),i=t(2265),a=t(7823);let o=(0,i.createContext)(void 0);function AuthProvider(r){let{children:e}=r,[t,u]=(0,i.useState)(null),[s,l]=(0,i.useState)(null),[c,d]=(0,i.useState)(null),[h,f]=(0,i.useState)(null),[m,w]=(0,i.useState)(!0),fetchUserData=async r=>{try{let{data:e,error:t}=await a.OQ.from("users").select("*").eq("id",r).single();if(t&&"PGRST116"!==t.code){console.error("Error fetching user:",t);return}if(e&&(l(e),e.company_id)){let{data:r,error:t}=await a.OQ.from("companies").select("*").eq("id",e.company_id).single();t?console.error("Error fetching company:",t):d(r)}}catch(r){console.error("Error in fetchUserData:",r)}};(0,i.useEffect)(()=>{let initializeAuth=async()=>{try{var r;let{data:{session:e}}=await a.OQ.auth.getSession();f(e),u(null!==(r=null==e?void 0:e.user)&&void 0!==r?r:null),(null==e?void 0:e.user)&&await fetchUserData(e.user.id)}catch(r){console.error("Error initializing auth:",r)}finally{w(!1)}};initializeAuth();let{data:{subscription:r}}=a.OQ.auth.onAuthStateChange(async(r,e)=>{var t;f(e),u(null!==(t=null==e?void 0:e.user)&&void 0!==t?t:null),(null==e?void 0:e.user)?await fetchUserData(e.user.id):(l(null),d(null)),w(!1)});return()=>{r.unsubscribe()}},[]);let signUp=async(r,e,t,n)=>{try{let{data:i,error:o}=await a.OQ.auth.signUp({email:r,password:e,options:{data:{full_name:t}}});if(o)return{error:o};if(!i.user)return{error:Error("Failed to create user")};let{data:u,error:s}=await a.OQ.from("companies").insert({name:n,email:r}).select().single();if(s)return console.error("Error creating company:",s),{error:s};let{error:l}=await a.OQ.from("users").insert({id:i.user.id,email:r,full_name:t,company_id:u.id,role:"owner"});if(l)return console.error("Error creating user profile:",l),{error:l};return{error:null}}catch(r){return console.error("Signup error:",r),{error:r}}},signIn=async(r,e)=>{try{let{error:t}=await a.OQ.auth.signInWithPassword({email:r,password:e});if(t)return{error:t};return{error:null}}catch(r){return{error:r}}},signOut=async()=>{await a.OQ.auth.signOut(),u(null),l(null),d(null),f(null)},resetPassword=async r=>{try{let{error:e}=await a.OQ.auth.resetPasswordForEmail(r,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(e)return{error:e};return{error:null}}catch(r){return{error:r}}};return(0,n.jsx)(o.Provider,{value:{user:t,dbUser:s,company:c,session:h,isLoading:m,signUp,signIn,signOut,resetPassword},children:e})}function useAuth(){let r=(0,i.useContext)(o);if(void 0===r)throw Error("useAuth must be used within an AuthProvider");return r}},7823:function(r,e,t){"use strict";t.d(e,{OQ:function(){return o}});var n=t(9073);let i="https://bqcymeefaizydfogaxcp.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxY3ltZWVmYWl6eWRmb2dheGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4Nzg0MjQsImV4cCI6MjA4NDQ1NDQyNH0.cTHXYffDL2DSePpTOCJIETtwlt8R1qJesyFs_5I3808";if(!i||!a)throw Error("Missing Supabase environment variables");let o=(0,n.eI)(i,a)},2148:function(){}},function(r){r.O(0,[311,971,472,744],function(){return r(r.s=2320)}),_N_E=r.O()}]);