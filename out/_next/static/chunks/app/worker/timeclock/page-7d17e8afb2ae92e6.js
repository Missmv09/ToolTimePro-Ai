(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[68],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return createLucideIcon}});var a=r(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),createLucideIcon=(e,t)=>{let r=(0,a.forwardRef)(({color:r="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:c="",children:o,...d},u)=>(0,a.createElement)("svg",{ref:u,...s,width:n,height:n,stroke:r,strokeWidth:l?24*Number(i)/Number(n):i,className:["lucide",`lucide-${toKebabCase(e)}`,c].join(" "),...d},[...t.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(o)?o:[o]]));return r.displayName=`${e}`,r}},1981:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},2894:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3067:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},4035:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},3008:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},7158:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},6523:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]])},8083:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6h0",key:"1uc279"}],["path",{d:"M14 6h0a6 6 0 0 1 6 6v3",key:"1j9mnm"}]])},6142:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},4900:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]])},6357:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]])},7980:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]])},2549:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8994:function(e,t,r){Promise.resolve().then(r.bind(r,6957))},6957:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return TimeClockPage}});var a=r(7437),s=r(2265),n=r(1396),i=r.n(n),l=r(2898);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,l.Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var o=r(3067),d=r(8083),u=r(6142),m=r(2894),h=r(1981);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,l.Z)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);var f=r(4900),k=r(6357),y=r(7980),g=r(6523),p=r(2549),b=r(4035),w=r(3008),v=r(7158),j=r(7823),N=r(3549);function useTimeClock(){let{dbUser:e,company:t}=(0,N.useAuth)(),[r,a]=(0,s.useState)({isLoading:!0,error:null,currentEntry:null,todaysBreaks:[],hoursWorked:0,isOnBreak:!1,currentBreak:null,complianceAlerts:[]}),n=(0,s.useRef)(null),i=(0,s.useCallback)(e=>{if(!e)return 0;let t=new Date(e.clock_in),r=e.clock_out?new Date(e.clock_out):new Date,a=r.getTime()-t.getTime(),s=(e.break_minutes||0)/60;return Math.max(0,a/36e5-s)},[]),l=(0,s.useCallback)(()=>new Promise(e=>{if(!navigator.geolocation){e(null);return}navigator.geolocation.getCurrentPosition(async t=>{let r={lat:t.coords.latitude,lng:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:new Date().toISOString()};try{let e=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(r.lat,"&lon=").concat(r.lng)),t=await e.json();t.display_name&&(r.address=t.display_name)}catch(e){}e(r)},()=>{e(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),[]),c=(0,s.useCallback)(async()=>{if((null==e?void 0:e.id)&&(null==t?void 0:t.id))try{let r=new Date().toISOString().split("T")[0],{data:s,error:n}=await j.OQ.from("time_entries").select("*").eq("user_id",e.id).eq("company_id",t.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).single();if(n&&"PGRST116"!==n.code)throw n;let l=[],c=null;if(s){let{data:e}=await j.OQ.from("breaks").select("*").eq("time_entry_id",s.id).order("break_start",{ascending:!0});c=(l=e||[]).find(e=>!e.break_end)||null}let{data:o}=await j.OQ.from("compliance_alerts").select("*").eq("user_id",e.id).eq("acknowledged",!1).gte("created_at","".concat(r,"T00:00:00"));a(e=>({...e,isLoading:!1,currentEntry:s,todaysBreaks:l,hoursWorked:i(s),isOnBreak:!!c,currentBreak:c,complianceAlerts:o||[]}))}catch(e){console.error("Error fetching time entry:",e),a(e=>({...e,isLoading:!1,error:"Failed to load time clock data"}))}},[null==e?void 0:e.id,null==t?void 0:t.id,i]),clockIn=async(r,s)=>{if(!(null==e?void 0:e.id)||!(null==t?void 0:t.id))return{success:!1,error:"Not authenticated"};try{let n=await l(),{data:i,error:c}=await j.OQ.from("time_entries").insert({company_id:t.id,user_id:e.id,job_id:r||null,clock_in:new Date().toISOString(),clock_in_location:n,clock_in_photo_url:s||null,status:"active"}).select().single();if(c)throw c;return a(e=>({...e,currentEntry:i,hoursWorked:0,error:null})),{success:!0}}catch(e){return console.error("Clock in error:",e),{success:!1,error:"Failed to clock in"}}},clockOut=async(s,n)=>{if(!r.currentEntry)return{success:!1,error:"No active time entry"};try{let i=await l(),c=0;for(let e of r.todaysBreaks)if(e.break_end){let t=new Date(e.break_start),r=new Date(e.break_end);c+=(r.getTime()-t.getTime())/6e4}let{error:o}=await j.OQ.from("time_entries").update({clock_out:new Date().toISOString(),clock_out_location:i,clock_out_photo_url:n||null,break_minutes:Math.round(c),status:"completed",attestation_completed:!0,attestation_at:new Date().toISOString(),attestation_signature:s.signature,missed_meal_break:s.missedMealBreak,missed_meal_reason:s.missedMealReason||null,missed_rest_break:s.missedRestBreak,missed_rest_reason:s.missedRestReason||null}).eq("id",r.currentEntry.id);if(o)throw o;return s.missedMealBreak&&(null==t?void 0:t.id)&&await j.OQ.from("compliance_alerts").insert({company_id:t.id,user_id:null==e?void 0:e.id,time_entry_id:r.currentEntry.id,alert_type:"meal_break_missed",severity:"violation",title:"Meal Break Violation",description:s.missedMealReason||"Employee reported missing meal break",hours_worked:r.hoursWorked}),a(e=>({...e,currentEntry:null,todaysBreaks:[],hoursWorked:0,isOnBreak:!1,currentBreak:null})),{success:!0}}catch(e){return console.error("Clock out error:",e),{success:!1,error:"Failed to clock out"}}},startBreak=async t=>{if(!r.currentEntry||!(null==e?void 0:e.id))return{success:!1,error:"No active time entry"};if(r.isOnBreak)return{success:!1,error:"Already on break"};try{let s=await l(),{data:n,error:i}=await j.OQ.from("breaks").insert({time_entry_id:r.currentEntry.id,user_id:e.id,break_type:t,break_start:new Date().toISOString(),location:s}).select().single();if(i)throw i;return a(e=>({...e,isOnBreak:!0,currentBreak:n,todaysBreaks:[...e.todaysBreaks,n]})),{success:!0}}catch(e){return console.error("Start break error:",e),{success:!1,error:"Failed to start break"}}},endBreak=async()=>{if(!r.currentBreak)return{success:!1,error:"Not on break"};try{let{error:e}=await j.OQ.from("breaks").update({break_end:new Date().toISOString()}).eq("id",r.currentBreak.id);if(e)throw e;return a(e=>({...e,isOnBreak:!1,currentBreak:null,todaysBreaks:e.todaysBreaks.map(t=>{var r;return t.id===(null===(r=e.currentBreak)||void 0===r?void 0:r.id)?{...t,break_end:new Date().toISOString()}:t})})),{success:!0}}catch(e){return console.error("End break error:",e),{success:!1,error:"Failed to end break"}}},waiveMealBreak=async()=>{if(!r.currentEntry||!(null==e?void 0:e.id))return{success:!1,error:"No active time entry"};try{let{error:t}=await j.OQ.from("breaks").insert({time_entry_id:r.currentEntry.id,user_id:e.id,break_type:"meal",break_start:new Date().toISOString(),break_end:new Date().toISOString(),waived:!0,notes:"Meal break waived by employee (shift <= 6 hours)"});if(t)throw t;return{success:!0}}catch(e){return console.error("Waive meal break error:",e),{success:!1,error:"Failed to waive meal break"}}},acknowledgeAlert=async t=>{(null==e?void 0:e.id)&&(await j.OQ.from("compliance_alerts").update({acknowledged:!0,acknowledged_at:new Date().toISOString(),acknowledged_by:e.id}).eq("id",t),a(e=>({...e,complianceAlerts:e.complianceAlerts.filter(e=>e.id!==t)})))},o=(0,s.useCallback)(()=>{if(!r.currentEntry)return[];let e=[],t=r.hoursWorked,a=r.todaysBreaks.some(e=>"meal"===e.break_type&&(e.break_end||e.waived));t>=4&&t<5&&!a&&e.push({id:"meal_warning",alert_type:"meal_break_due",severity:"warning",title:"Meal Break Coming Up",description:"Take your 30-minute meal break before ".concat(5," hours"),hours_worked:t}),t>=5&&!a&&e.push({id:"meal_required",alert_type:"meal_break_missed",severity:"violation",title:"Meal Break Required NOW",description:"CA law requires a 30-minute meal break before 5 hours",hours_worked:t});let s=r.todaysBreaks.filter(e=>"rest"===e.break_type&&e.break_end).length;return s<Math.floor(t/4)&&e.push({id:"rest_due",alert_type:"rest_break_due",severity:"warning",title:"Rest Break Due",description:"Take a 10-minute paid rest break",hours_worked:t}),t>=8&&t<12&&e.push({id:"overtime",alert_type:"overtime_warning",severity:"info",title:"Overtime Started",description:"You are now earning 1.5x overtime pay",hours_worked:t}),t>=12&&e.push({id:"doubletime",alert_type:"double_time_warning",severity:"warning",title:"Double Time Started",description:"You are now earning 2x double time pay",hours_worked:t}),e},[r.currentEntry,r.hoursWorked,r.todaysBreaks]);return(0,s.useEffect)(()=>(r.currentEntry&&!r.isOnBreak&&(n.current=setInterval(()=>{a(e=>({...e,hoursWorked:i(e.currentEntry)}))},6e4)),()=>{n.current&&clearInterval(n.current)}),[r.currentEntry,r.isOnBreak,i]),(0,s.useEffect)(()=>{c()},[c]),(0,s.useEffect)(()=>{if(!(null==e?void 0:e.id))return;let t=j.OQ.channel("time-clock-changes").on("postgres_changes",{event:"*",schema:"public",table:"time_entries",filter:"user_id=eq.".concat(e.id)},()=>{c()}).subscribe();return()=>{j.OQ.removeChannel(t)}},[null==e?void 0:e.id,c]),{...r,clockIn,clockOut,startBreak,endBreak,waiveMealBreak,acknowledgeAlert,checkCompliance:o,refetch:c}}var _=r(8581);function formatHours(e){let t=Math.floor(e);return"".concat(t,":").concat(Math.floor((e-t)*60).toString().padStart(2,"0"))}function formatTime(e){let t=new Date(e);return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function TimeClockPage(){let{dbUser:e,company:t}=(0,N.useAuth)(),{isLoading:r,error:n,currentEntry:l,todaysBreaks:w,hoursWorked:v,isOnBreak:j,currentBreak:C,clockIn:S,clockOut:O,startBreak:Z,endBreak:B,waiveMealBreak:M,checkCompliance:E}=useTimeClock(),[I,A]=(0,s.useState)(!1),[D,T]=(0,s.useState)(null),[R,q]=(0,s.useState)(!1),[L,P]=(0,s.useState)(!1),[Q,z]=(0,s.useState)("pending"),W=(0,s.useRef)(null),U=(0,s.useRef)(null),F=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(navigator.geolocation){var e;null===(e=navigator.permissions)||void 0===e||e.query({name:"geolocation"}).then(e=>{z("granted"===e.state?"granted":"pending")})}},[]);let H=E(),startCamera=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});F.current=e,W.current&&(W.current.srcObject=e),A(!0)}catch(e){console.error("Camera error:",e),handleClockAction(null)}},stopCamera=()=>{F.current&&(F.current.getTracks().forEach(e=>e.stop()),F.current=null),A(!1)},handleClockAction=async e=>{if(q(!0),!l){let t=await S(void 0,e||void 0);t.success||alert(t.error)}q(!1),T(null)},handleBreakAction=async e=>{q(!0),j?await B():await Z(e),q(!1)},handleWaiveMealBreak=async()=>{q(!0),await M(),q(!1)};return r?(0,a.jsx)(_.Z,{children:(0,a.jsx)("div",{className:"min-h-screen bg-navy-gradient flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c,{className:"w-12 h-12 text-gold-500 animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-white",children:"Loading time clock..."})]})})}):(0,a.jsx)(_.Z,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-navy-gradient",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,a.jsxs)(i(),{href:"/dashboard",className:"text-white/80 hover:text-white flex items-center gap-2",children:[(0,a.jsx)(o.Z,{size:20}),"Back"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gold-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(d.Z,{className:"w-5 h-5 text-navy-500"})}),(0,a.jsx)("span",{className:"font-bold text-white",children:"Time Clock"})]}),(0,a.jsx)("div",{className:"w-16"})," "]}),(0,a.jsxs)("div",{className:"px-4 pb-8",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("p",{className:"text-white/60 text-sm",children:null==t?void 0:t.name}),(0,a.jsx)("p",{className:"text-white text-xl font-semibold",children:null==e?void 0:e.full_name})]}),(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur rounded-2xl p-6 mb-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-white/60 text-sm mb-2",children:l?"Hours Worked Today":"Current Time"}),(0,a.jsx)("p",{className:"text-5xl font-bold text-white font-mono",children:l?formatHours(v):new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),l&&(0,a.jsxs)("p",{className:"text-white/60 text-sm mt-2",children:["Clocked in at ",formatTime(l.clock_in)]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-4 text-sm",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-gold-500"}),(0,a.jsx)("span",{className:"text-white/60",children:"granted"===Q?"Location enabled":"Location will be requested"})]})]}),H.length>0&&(0,a.jsx)("div",{className:"space-y-3 mb-6",children:H.map(e=>(0,a.jsxs)("div",{className:"p-4 rounded-xl flex items-start gap-3 ".concat("violation"===e.severity?"bg-red-500/20 border border-red-500/30":"warning"===e.severity?"bg-amber-500/20 border border-amber-500/30":"bg-blue-500/20 border border-blue-500/30"),children:["violation"===e.severity?(0,a.jsx)(m.Z,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}):"warning"===e.severity?(0,a.jsx)(h.Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}):(0,a.jsx)(x,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-semibold text-white",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-white/70",children:e.description})]})]},e.id))}),(0,a.jsx)("div",{className:"flex justify-center mb-6",children:l?(0,a.jsx)("button",{onClick:()=>{P(!0)},disabled:R||j,className:"w-40 h-40 rounded-full bg-red-500 hover:bg-red-400 active:bg-red-600 transition-all flex flex-col items-center justify-center shadow-xl disabled:opacity-50 disabled:bg-gray-500",children:R?(0,a.jsx)(c,{className:"w-12 h-12 text-white animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{className:"w-12 h-12 text-white mb-1"}),(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:"CLOCK OUT"})]})}):(0,a.jsx)("button",{onClick:()=>startCamera(),disabled:R,className:"w-40 h-40 rounded-full bg-green-500 hover:bg-green-400 active:bg-green-600 transition-all flex flex-col items-center justify-center shadow-xl disabled:opacity-50",children:R?(0,a.jsx)(c,{className:"w-12 h-12 text-white animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z,{className:"w-12 h-12 text-white mb-1"}),(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:"CLOCK IN"})]})})}),l&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("button",{onClick:()=>handleBreakAction("meal"),disabled:R,className:"p-4 rounded-xl flex items-center gap-3 transition-all ".concat(j&&(null==C?void 0:C.break_type)==="meal"?"bg-amber-500 text-white":"bg-white/10 text-white hover:bg-white/20"),children:[(0,a.jsx)(y.Z,{className:"w-6 h-6"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-semibold",children:j&&(null==C?void 0:C.break_type)==="meal"?"End Meal Break":"Meal Break"}),(0,a.jsx)("p",{className:"text-xs opacity-70",children:"30 min unpaid"})]})]}),(0,a.jsxs)("button",{onClick:()=>handleBreakAction("rest"),disabled:R,className:"p-4 rounded-xl flex items-center gap-3 transition-all ".concat(j&&(null==C?void 0:C.break_type)==="rest"?"bg-blue-500 text-white":"bg-white/10 text-white hover:bg-white/20"),children:[(0,a.jsx)(g.Z,{className:"w-6 h-6"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-semibold",children:j&&(null==C?void 0:C.break_type)==="rest"?"End Rest Break":"Rest Break"}),(0,a.jsx)("p",{className:"text-xs opacity-70",children:"10 min paid"})]})]})]}),l&&v<6&&v>=4&&!w.some(e=>"meal"===e.break_type)&&(0,a.jsx)("button",{onClick:handleWaiveMealBreak,disabled:R,className:"w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white/70 hover:bg-white/10 transition-all mb-6",children:(0,a.jsx)("p",{className:"text-sm",children:"Waive Meal Break (shifts â‰¤ 6 hours)"})}),w.length>0&&(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-white/60 text-sm mb-3",children:"Today's Breaks"}),(0,a.jsx)("div",{className:"space-y-2",children:w.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-white/80 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["meal"===e.break_type?(0,a.jsx)(y.Z,{className:"w-4 h-4"}):(0,a.jsx)(g.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"capitalize",children:e.break_type}),e.waived&&(0,a.jsx)("span",{className:"text-xs bg-white/20 px-2 py-0.5 rounded",children:"Waived"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{children:formatTime(e.break_start)}),e.break_end&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mx-1",children:"-"}),(0,a.jsx)("span",{children:formatTime(e.break_end)})]}),!e.break_end&&!e.waived&&(0,a.jsx)("span",{className:"text-green-400 ml-2",children:"In Progress"})]})]},e.id))})]}),n&&(0,a.jsx)("div",{className:"p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:n})]}),I&&(0,a.jsxs)("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsx)("button",{onClick:stopCamera,className:"text-white",children:(0,a.jsx)(p.Z,{size:24})}),(0,a.jsx)("span",{className:"text-white font-semibold",children:"Take a Selfie"}),(0,a.jsx)("div",{className:"w-6"})]}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)("video",{ref:W,autoPlay:!0,playsInline:!0,muted:!0,className:"max-w-full max-h-full object-contain"})}),(0,a.jsx)("div",{className:"p-6 flex justify-center",children:(0,a.jsx)("button",{onClick:()=>{if(W.current&&U.current){let e=U.current.getContext("2d");if(e){U.current.width=W.current.videoWidth,U.current.height=W.current.videoHeight,e.drawImage(W.current,0,0);let t=U.current.toDataURL("image/jpeg",.7);T(t),stopCamera(),handleClockAction(t)}}},className:"w-20 h-20 rounded-full bg-white flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"w-8 h-8 text-navy-500"})})}),(0,a.jsx)("canvas",{ref:U,className:"hidden"})]}),L&&(0,a.jsx)(AttestationModal,{hoursWorked:v,todaysBreaks:w,onComplete:async e=>{P(!1),q(!0);let t=await O(e);t.success||alert(t.error),q(!1)},onCancel:()=>P(!1)})]})})}function AttestationModal(e){let{hoursWorked:t,todaysBreaks:r,onComplete:n,onCancel:i}=e,[l,c]=(0,s.useState)(1),[o,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)(""),[h,x]=(0,s.useState)(!1),[f,k]=(0,s.useState)(""),[b,j]=(0,s.useState)(""),N=(0,s.useRef)(null),_=(0,s.useRef)(!1),C=r.some(e=>"meal"===e.break_type&&(e.break_end||e.waived)),S=r.filter(e=>"rest"===e.break_type&&e.break_end).length,O=Math.floor(t/4);(0,s.useEffect)(()=>{let e=N.current;if(e&&2===l){let t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.strokeStyle="#1a365d",t.lineWidth=2,t.lineCap="round")}},[l]);let startDrawing=e=>{_.current=!0;let t=N.current,r=null==t?void 0:t.getContext("2d");if(r&&t){let a=t.getBoundingClientRect(),s="touches"in e?e.touches[0].clientX-a.left:e.clientX-a.left,n="touches"in e?e.touches[0].clientY-a.top:e.clientY-a.top;r.beginPath(),r.moveTo(s,n)}},draw=e=>{if(!_.current)return;let t=N.current,r=null==t?void 0:t.getContext("2d");if(r&&t){let a=t.getBoundingClientRect(),s="touches"in e?e.touches[0].clientX-a.left:e.clientX-a.left,n="touches"in e?e.touches[0].clientY-a.top:e.clientY-a.top;r.lineTo(s,n),r.stroke()}},stopDrawing=()=>{_.current=!1},saveSignature=()=>{let e=N.current;if(e){let t=e.toDataURL("image/png");j(t)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-end sm:items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-t-2xl sm:rounded-2xl p-6 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-navy-500",children:"Clock Out Attestation"}),(0,a.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(p.Z,{size:24})})]}),1===l&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Please confirm your breaks for today. This is required by California labor law."}),(0,a.jsx)("div",{className:"p-4 bg-gray-50 rounded-xl",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(y.Z,{className:"w-5 h-5 text-amber-500 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-navy-500",children:"30-Minute Meal Break"}),C?(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-green-600",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Meal break taken"})]}):t>=5?(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:o,onChange:e=>d(e.target.checked),className:"w-4 h-4 rounded border-gray-300"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"I was unable to take my meal break"})]}),o&&(0,a.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),placeholder:"Please explain why...",className:"w-full mt-2 p-2 border rounded-lg text-sm",rows:2})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Not required for shifts under 5 hours"})]})]})}),(0,a.jsx)("div",{className:"p-4 bg-gray-50 rounded-xl",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(g.Z,{className:"w-5 h-5 text-blue-500 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-navy-500",children:"10-Minute Rest Breaks"}),S>=O?(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-green-600",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{className:"text-sm",children:[S," of ",O," rest breaks taken"]})]}):O>0?(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("p",{className:"text-sm text-amber-600 mb-2",children:[S," of ",O," rest breaks taken"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:h,onChange:e=>x(e.target.checked),className:"w-4 h-4 rounded border-gray-300"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"I was unable to take all rest breaks"})]}),h&&(0,a.jsx)("textarea",{value:f,onChange:e=>k(e.target.value),placeholder:"Please explain why...",className:"w-full mt-2 p-2 border rounded-lg text-sm",rows:2})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Not required for shifts under 4 hours"})]})]})}),(0,a.jsxs)("button",{onClick:()=>c(2),className:"btn-primary w-full flex items-center justify-center gap-2",children:["Continue to Signature",(0,a.jsx)(v.Z,{size:18})]})]}),2===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"By signing below, I confirm that the break information above is accurate and that I have been provided the opportunity to take all required breaks."}),(0,a.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-xl overflow-hidden",children:(0,a.jsx)("canvas",{ref:N,width:400,height:150,className:"w-full touch-none cursor-crosshair",onMouseDown:startDrawing,onMouseMove:draw,onMouseUp:stopDrawing,onMouseLeave:stopDrawing,onTouchStart:startDrawing,onTouchMove:draw,onTouchEnd:stopDrawing})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{onClick:()=>{let e=N.current,t=null==e?void 0:e.getContext("2d");t&&e&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),j("")},className:"text-sm text-gray-500 hover:text-gray-700",children:"Clear Signature"}),(0,a.jsx)("button",{onClick:()=>c(1),className:"text-sm text-navy-500 hover:underline",children:"Back"})]}),(0,a.jsxs)("button",{onClick:()=>{var e;b||saveSignature(),n({missedMealBreak:o,missedMealReason:o?u:void 0,missedRestBreak:h,missedRestReason:h?f:void 0,signature:b||(null===(e=N.current)||void 0===e?void 0:e.toDataURL("image/png"))||""})},className:"btn-secondary w-full flex items-center justify-center gap-2",children:[(0,a.jsx)(w.Z,{size:18}),"Confirm & Clock Out"]})]})]})})}},8581:function(e,t,r){"use strict";r.d(t,{Z:function(){return ProtectedRoute}});var a=r(7437),s=r(2265),n=r(4033),i=r(3549);function ProtectedRoute(e){let{children:t,requiredRole:r}=e,{user:l,dbUser:c,isLoading:o}=(0,i.useAuth)(),d=(0,n.useRouter)();return((0,s.useEffect)(()=>{if(o||l||d.push("/auth/login"),!o&&l&&c&&r){let e={owner:3,admin:2,worker:1},t=e[c.role]||0,a=e[r]||0;t<a&&d.push("/dashboard")}},[l,c,o,d,r]),o)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-gold-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):l?(0,a.jsx)(a.Fragment,{children:t}):null}},3549:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var a=r(7437),s=r(2265),n=r(7823);let i=(0,s.createContext)(void 0);function AuthProvider(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[c,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[x,f]=(0,s.useState)(!0),fetchUserData=async e=>{try{let{data:t,error:r}=await n.OQ.from("users").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code){console.error("Error fetching user:",r);return}if(t&&(o(t),t.company_id)){let{data:e,error:r}=await n.OQ.from("companies").select("*").eq("id",t.company_id).single();r?console.error("Error fetching company:",r):u(e)}}catch(e){console.error("Error in fetchUserData:",e)}};(0,s.useEffect)(()=>{let initializeAuth=async()=>{try{var e;let{data:{session:t}}=await n.OQ.auth.getSession();h(t),l(null!==(e=null==t?void 0:t.user)&&void 0!==e?e:null),(null==t?void 0:t.user)&&await fetchUserData(t.user.id)}catch(e){console.error("Error initializing auth:",e)}finally{f(!1)}};initializeAuth();let{data:{subscription:e}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{var r;h(t),l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),(null==t?void 0:t.user)?await fetchUserData(t.user.id):(o(null),u(null)),f(!1)});return()=>{e.unsubscribe()}},[]);let signUp=async(e,t,r,a)=>{try{let{data:s,error:i}=await n.OQ.auth.signUp({email:e,password:t,options:{data:{full_name:r}}});if(i)return{error:i};if(!s.user)return{error:Error("Failed to create user")};let{data:l,error:c}=await n.OQ.from("companies").insert({name:a,email:e}).select().single();if(c)return console.error("Error creating company:",c),{error:c};let{error:o}=await n.OQ.from("users").insert({id:s.user.id,email:e,full_name:r,company_id:l.id,role:"owner"});if(o)return console.error("Error creating user profile:",o),{error:o};return{error:null}}catch(e){return console.error("Signup error:",e),{error:e}}},signIn=async(e,t)=>{try{let{error:r}=await n.OQ.auth.signInWithPassword({email:e,password:t});if(r)return{error:r};return{error:null}}catch(e){return{error:e}}},signOut=async()=>{await n.OQ.auth.signOut(),l(null),o(null),u(null),h(null)},resetPassword=async e=>{try{let{error:t}=await n.OQ.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(t)return{error:t};return{error:null}}catch(e){return{error:e}}};return(0,a.jsx)(i.Provider,{value:{user:r,dbUser:c,company:d,session:m,isLoading:x,signUp,signIn,signOut,resetPassword},children:t})}function useAuth(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7823:function(e,t,r){"use strict";r.d(t,{OQ:function(){return i}});var a=r(9073);let s="https://bqcymeefaizydfogaxcp.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxY3ltZWVmYWl6eWRmb2dheGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4Nzg0MjQsImV4cCI6MjA4NDQ1NDQyNH0.cTHXYffDL2DSePpTOCJIETtwlt8R1qJesyFs_5I3808";if(!s||!n)throw Error("Missing Supabase environment variables");let i=(0,a.eI)(s,n)},1396:function(e,t,r){e.exports=r(8326)},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[326,311,971,472,744],function(){return e(e.s=8994)}),_N_E=e.O()}]);