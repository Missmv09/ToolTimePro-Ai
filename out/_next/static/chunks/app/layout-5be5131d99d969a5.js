(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{2320:function(r,e,t){Promise.resolve().then(t.bind(t,3549)),Promise.resolve().then(t.t.bind(t,2148,23))},3549:function(r,e,t){"use strict";t.r(e),t.d(e,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var n=t(7437),o=t(2265),a=t(7823);let i=(0,o.createContext)(void 0);function AuthProvider(r){let{children:e}=r,[t,u]=(0,o.useState)(null),[s,l]=(0,o.useState)(null),[c,f]=(0,o.useState)(null),[d,h]=(0,o.useState)(null),[_,p]=(0,o.useState)(!0),fetchUserData=async r=>{try{let{data:e,error:t}=await a.OQ.from("users").select("*").eq("id",r).single();if(t&&"PGRST116"!==t.code){console.error("Error fetching user:",t);return}if(e&&(l(e),e.company_id)){let{data:r,error:t}=await a.OQ.from("companies").select("*").eq("id",e.company_id).single();t?console.error("Error fetching company:",t):f(r)}}catch(r){console.error("Error in fetchUserData:",r)}};(0,o.useEffect)(()=>{let initializeAuth=async()=>{try{var r;let{data:{session:e}}=await a.OQ.auth.getSession();h(e),u(null!==(r=null==e?void 0:e.user)&&void 0!==r?r:null),(null==e?void 0:e.user)&&await fetchUserData(e.user.id)}catch(r){console.error("Error initializing auth:",r)}finally{p(!1)}};initializeAuth();let{data:{subscription:r}}=a.OQ.auth.onAuthStateChange(async(r,e)=>{var t;h(e),u(null!==(t=null==e?void 0:e.user)&&void 0!==t?t:null),(null==e?void 0:e.user)?await fetchUserData(e.user.id):(l(null),f(null)),p(!1)});return()=>{r.unsubscribe()}},[]);let signUp=async(r,e,t,n)=>{try{let{data:o,error:i}=await a.OQ.auth.signUp({email:r,password:e,options:{data:{full_name:t}}});if(i)return{error:i};if(!o.user)return{error:Error("Failed to create user")};let{data:u,error:s}=await a.OQ.from("companies").insert({name:n,email:r}).select().single();if(s)return console.error("Error creating company:",s),{error:s};let{error:l}=await a.OQ.from("users").insert({id:o.user.id,email:r,full_name:t,company_id:u.id,role:"owner"});if(l)return console.error("Error creating user profile:",l),{error:l};return{error:null}}catch(r){return console.error("Signup error:",r),{error:r}}},signIn=async(r,e)=>{try{let{error:t}=await a.OQ.auth.signInWithPassword({email:r,password:e});if(t)return{error:t};return{error:null}}catch(r){return{error:r}}},signOut=async()=>{await a.OQ.auth.signOut(),u(null),l(null),f(null),h(null)},resetPassword=async r=>{try{let{error:e}=await a.OQ.auth.resetPasswordForEmail(r,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(e)return{error:e};return{error:null}}catch(r){return{error:r}}};return(0,n.jsx)(i.Provider,{value:{user:t,dbUser:s,company:c,session:d,isLoading:_,signUp,signIn,signOut,resetPassword},children:e})}function useAuth(){let r=(0,o.useContext)(i);if(void 0===r)throw Error("useAuth must be used within an AuthProvider");return r}},7823:function(r,e,t){"use strict";t.d(e,{OQ:function(){return s}});var n=t(9073),o=t(2601);let a=o.env.NEXT_PUBLIC_SUPABASE_URL||"",i=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",u=null,s=u||(a&&i||console.warn("Supabase environment variables not configured"),u=(0,n.eI)(a||"https://placeholder.supabase.co",i||"placeholder"))},2148:function(){},622:function(r,e,t){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=t(2265),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,u=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function q(r,e,t){var n,a={},l=null,c=null;for(n in void 0!==t&&(l=""+t),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(c=e.ref),e)i.call(e,n)&&!s.hasOwnProperty(n)&&(a[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps)void 0===a[n]&&(a[n]=e[n]);return{$$typeof:o,type:r,key:l,ref:c,props:a,_owner:u.current}}e.Fragment=a,e.jsx=q,e.jsxs=q},7437:function(r,e,t){"use strict";r.exports=t(622)}},function(r){r.O(0,[978,971,472,744],function(){return r(r.s=2320)}),_N_E=r.O()}]);